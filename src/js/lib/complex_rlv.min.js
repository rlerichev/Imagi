(function(a){'use strict';var b=a.Math,c=a.Number,d=b.PI,e,f=[],g,h=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,i=/[a-z]*\(|(?:-|e\^)\(?/i,j=/[a-z]+(?![a-z\(])/i,k=/[\+\-\*\/\^ %]/,l=/(?:\d*\.\d+|\d+\.\d*|\d+)(?:e[\-+]?\d+(?![\d\.]))?/i,m=/\{|\[/,n=/\}|\]/,o=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,p=/(?:\d*\.\d+|\d+\.\d*|\d+)e[\-+]?\d+(?![\d\.])/i,q=/[\+\-\*\/\^%]/,r={'(':'(','sqrt(':'C.sqrt(','cbrt(':'C.cbrt(','exp(':'C.exp(','e^(':'C.exp(','e^':'C.exp(','log(':'C.log(','ln(':'C.log(','gamma(':'C.gamma(','fact(':'C.fact(','factorial(':'C.fact(','sin(':'C.sin(','cos(':'C.cos(','tan(':'C.tan(','sec(':'C.sec(','csc(':'C.csc(','cot(':'C.cot(','arcsin(':'C.arcsin(','arccos(':'C.arccos(','arctan(':'C.arctan(','arcsec(':'C.arcsec(','arccsc(':'C.arccsc(','arccot(':'C.arccot(','arsin(':'C.arcsin(','arcos(':'C.arccos(','artan(':'C.arctan(','arsec(':'C.arcsec(','arcsc(':'C.arccsc(','arcot(':'C.arccot(','asin(':'C.arcsin(','acos(':'C.arccos(','atan(':'C.arctan(','asec(':'C.arcsec(','acsc(':'C.arccsc(','acot(':'C.arccot(','sinh(':'C.sinh(','cosh(':'C.cosh(','tanh(':'C.tanh(','sech(':'C.sech(','csch(':'C.csch(','coth(':'C.coth(','arcsinh(':'C.arcsinh(','arccosh(':'C.arccosh(','arctanh(':'C.arctanh(','arcsech(':'C.arcsech(','arccsch(':'C.arccsch(','arccoth(':'C.arccoth(','arsinh(':'C.arcsinh(','arcosh(':'C.arccosh(','artanh(':'C.arctanh(','arsech(':'C.arcsech(','arcsch(':'C.arccsch(','arcoth(':'C.arccoth(','asinh(':'C.arcsinh(','acosh(':'C.arccosh(','atanh(':'C.arctanh(','asech(':'C.arcsech(','acsch(':'C.arccsch(','acoth(':'C.arccoth(','-':'C.neg(','-(':'C.neg(','re(':'C.re(','real(':'C.re(','im(':'C.im(','imag(':'C.im(','abs(':'C.abs(','mag(':'C.abs(','arg(':'C.arg(','conj(':'C.conj(','norm(':'C.norm(','normal(':'C.norm(','floor(':'C.floor(','ceil(':'C.ceil(','ceiling(':'C.ceil(','round(':'C.round(','fpart(':'C.fPart(','frac(':'C.fPart(','ipart(':'C.iPart(','int(':'C.iPart('},s={'+':'.add(','-':'.sub(','*':'.mult(',' ':'.mult(','/':'.div(','%':'.mod(','^':'.pow('},t={'e':'C.E','i':'C.I','pi':'C.PI'};function u(a){return(a>=0?a-a%1:a-(1+a%1)%1);}function v(a){return(a>=0?a+(1-a%1)%1:a-a%1);}function w(a){return u(a+0.5);}function x(a){return a-a%1;}function y(a){return a%1;}if(b.sinh===undefined)b.sinh=function(a){return(b.exp(a)-b.exp(-a))/2;};if(b.cosh===undefined)b.cosh=function(a){return(b.exp(a)+b.exp(-a))/2;};if(c.EPSILON===undefined)c.EPSILON=2.220446049250313e-16;function z(a,b){if(!(this instanceof z))return new z(a,b);this.r=a;this.i=b;}e=new z(b.sqrt(2*d),0);g=[0.99999999999980993,676.5203681218851,-1259.1392167224028,771.32342877765313,-176.61502916214059,12.507343278686905,-0.13857109526572012,9.9843695780195716e-6,1.5056327351493116e-7].map(function(a,b){f.push(new z(b,0));return new z(a,0);});z.ZERO=new z(0,0);z.ONE=new z(1,0);z.I=new z(0,1);z.NEG_I=new z(0,-1);z.PI=new z(d,0);z.E=new z(b.E,0);z.TWO=new z(2,0);z.TWO_I=new z(0,2);z.Polar=function(a,c){return new z(a*b.cos(c),a*b.sin(c));};z.prototype.toString=function(a,c){var d,e,f,g;if(!z.isFinite(this))return 'Infinity';if(z.isNaN(this))return 'NaN';if(a===undefined)a=true;if(c===undefined)c=4;if(a){d=this.r.toPrecision(c);e=this.i.toPrecision(c);if(this.i===0)return d;if(this.r===0)return b.abs(this.i)===1?(this.i>0?'i':'-i'):e+'i';return d+(this.i>0?'+':'')+(b.abs(this.i)===1?(this.i>0?'i':'-i'):e+'i');}f=(b.sqrt(this.r*this.r+this.i*this.i)).toPrecision(c);g=(b.atan2(this.i,this.r)).toPrecision(c);return f+' e^('+g+'i)';};z.prototype.equals=z.prototype['=']=function(a){var d=this.r,e=this.i,f=a.r,g=a.i,h=b.abs(d-f)<=b.max(b.abs(d),b.abs(f))*c.EPSILON,i=b.abs(e-g)<=b.max(b.abs(e),b.abs(g))*c.EPSILON;return(h&&i);};z.prototype.re=z.prototype.real=function(){return this.r;};z.prototype.im=z.prototype.imag=function(){return this.i;};z.prototype.abs=z.prototype.mag=function(){return b.sqrt(this.r*this.r+this.i*this.i);};z.prototype.arg=z.prototype.angle=function(){return b.atan2(this.i,this.r);};z.prototype.abs2=z.prototype.mag2=function(){return this.r*this.r+this.i*this.i;};z.prototype.rAdd=function(a){return new z(this.r+a,this.i);};z.prototype.add=z.prototype['+']=function(a){return new z(this.r+a.r,this.i+a.i);};z.prototype.rSub=function(a){return new z(this.r-a,this.i);};z.prototype.sub=z.prototype['-']=function(a){return new z(this.r-a.r,this.i-a.i);};z.prototype.rMult=function(a){return new z(a*this.r,a*this.i);};z.prototype.mult=z.prototype['*']=function(a){return new z(this.r*a.r-this.i*a.i,this.r*a.i+this.i*a.r);};z.prototype.rDiv=function(a){return new z(this.r/a,this.i/a);};z.prototype.div=z.prototype['/']=function(a){var b=a.mag2();return new z((this.r*a.r+this.i*a.i)/b,(this.i*a.r-this.r*a.i)/b);};z.prototype.rMod=function(a){return new z(a===0?0:this.r%a,this.i);};z.prototype.mod=z.prototype['%']=function(a){return new z(a.r===0?0:this.r%a.r,a.i===0?0:this.i%a.i);};z.prototype.rPow=function(a){if(a===0)return new z(1,0);if(a===1)return new z(this.r,this.i);if(a===2)return z.square(this);if(a===3)return z.cube(this);return z.Polar(b.pow(this.mag(),a),this.angle()*a);};z.prototype.pow=z.prototype['^']=function(a){if(a.i===0)return this.rPow(a.r);var c=this.mag(),d=this.angle();return z.Polar(b.pow(c,a.r)*b.exp(-a.i*d),a.i*b.log(c)+a.r*d);};z.neg=function(a){return new z(-a.r,-a.i);};z.re=function(a){return new z(a.r,0);};z.im=function(a){return new z(a.i,0);};z.abs=function(a){return new z(b.sqrt(a.r*a.r+a.i*a.i),0);};z.arg=function(a){return new z(b.atan2(a.i,a.r),0);};z.conj=function(a){return new z(a.r,-a.i);};z.norm=function(a){var b=a.mag();return b===0?new z(Infinity,Infinity):new z(a.r/b,a.i/b);};z.floor=function(a){return new z(u(a.r),u(a.i));};z.ceil=function(a){return new z(v(a.r),v(a.i));};z.round=function(a){return new z(w(a.r),w(a.i));};z.iPart=function(a){return new z(x(a.r),x(a.i));};z.fPart=function(a){return new z(y(a.r),y(a.i));};z.square=function(a){return new z(a.r*a.r-a.i*a.i,2*a.r*a.i);};z.cube=function(a){return new z(a.r*a.r*a.r-3*a.r*a.i*a.i,3*a.r*a.r*a.i-a.i*a.i*a.i);};z.sqrt=function(a){return a.rPow(0.5);};z.cbrt=function(a){return a.rPow(1.0/3.0);};z.exp=function(a){return a.i===0?z.E.rPow(a.r):z.Polar(b.exp(a.r),a.i);};z.log=function(a){return new z(b.log(a.mag()),a.angle());};z.gamma=function(a){var b,c,d,h;if(a.r<0.5)return z.PI.div(z.sin(z.PI.mult(a)).mult(z.gamma(z.ONE.sub(a))));b=a.sub(z.ONE);c=g[0];for(d=1;d<9;d++)c=c.add(g[d].div(b.add(f[d])));h=b.add(new z(7.5,0));return e.mult(h.pow(b.add(new z(0.5,0)))).mult(z.exp(z.neg(h))).mult(c);};z.fact=function(a){return z.gamma(a.add(z.ONE));};z.cos=function(a){var b=a.mult(z.I);return z.exp(b).add(z.exp(z.neg(b))).div(z.TWO);};z.sin=function(a){var b=a.mult(z.I);return z.exp(b).sub(z.exp(z.neg(b))).div(z.TWO_I);};z.tan=function(a){var b=a.mult(z.I),c=z.exp(b),d=z.exp(z.neg(b));return c.sub(d).div(c.add(d).mult(z.I));};z.sec=function(a){var b=a.mult(z.I);return z.TWO.div(z.exp(b).add(z.exp(z.neg(b))));};z.csc=function(a){var b=a.mult(z.I);return z.TWO_I.div(z.exp(b).sub(z.exp(z.neg(b))));};z.cot=function(a){var b=a.mult(z.I),c=z.exp(b),d=z.exp(z.neg(b));return c.add(d).mult(z.I).div(c.sub(d));};z.arccos=function(a){return z.I.mult(z.log(a.add(z.NEG_I.mult(z.sqrt(z.ONE.sub(a.rPow(2)))))));};z.arcsin=function(a){return z.NEG_I.mult(z.log(a.mult(z.I).add(z.sqrt(z.ONE.sub(a.rPow(2))))));};z.arctan=function(a){var b=z.I;return b.mult(z.log(b.add(a).div(b.sub(a)))).div(z.TWO);};z.arcsec=function(a){return z.NEG_I.mult(z.log(a.rPow(-1).add(z.sqrt(z.ONE.sub(z.I.div(a.rPow(2)))))));};z.arccsc=function(a){return z.NEG_I.mult(z.log(z.I.div(a).add(z.sqrt(z.ONE.sub(a.rPow(-2))))));};z.arccot=function(a){var b=z.I;return b.mult(z.log(a.sub(b).div(a.add(b)))).div(z.TWO);};z.cosh=function(a){return z.exp(a).add(z.exp(z.neg(a))).div(z.TWO);};z.sinh=function(a){return z.exp(a).sub(z.exp(z.neg(a))).div(z.TWO);};z.tanh=function(a){var b=z.exp(a),c=z.exp(z.neg(a));return b.sub(c).div(b.add(c));};z.sech=function(a){return z.TWO.div(z.exp(a).add(z.exp(z.neg(a))));};z.csch=function(a){return z.TWO.div(z.exp(a).sub(z.exp(z.neg(a))));};z.coth=function(a){var b=z.exp(a),c=z.exp(z.neg(a));return b.add(c).div(b.sub(c));};z.arccosh=function(a){return z.log(a.add(z.sqrt(a.rPow(2).sub(z.ONE))));};z.arcsinh=function(a){return z.log(a.add(z.sqrt(a.rPow(2).add(z.ONE))));};z.arctanh=function(a){return z.log(z.ONE.add(a).div(z.ONE.sub(a))).div(z.TWO);};z.arcsech=function(a){return z.log(z.ONE.add(z.sqrt(z.ONE.sub(a.rPow(2)))).div(a));};z.arccsch=function(a){return z.log(z.ONE.add(z.sqrt(z.ONE.add(a.rPow(2)))).div(a));};z.arccoth=function(a){return z.log(a.add(z.ONE).div(a.sub(z.ONE))).div(z.TWO);};z.min=function(){var a=Array.prototype.slice.call(arguments).map(function(a){return a.mag2();}),c=b.min.apply(b,a);return arguments[a.indexOf(c)];};z.max=function(){var a=Array.prototype.slice.call(arguments).map(function(a){return a.mag2();}),c=b.max.apply(b,a);return arguments[a.indexOf(c)];};z.isNaN=function(a){return isNaN(a.r)||isNaN(a.i);};z.isFinite=function(a){return isFinite(a.mag2());};function A(a,b,c){var d;if(o.test(a)){if(p.test(c.slice(b)))return a;return a.charAt(0).replace(h,A)+'*'+a.charAt(1).replace(h,A);}if(m.test(a))return '(';if(n.test(a))return ')';d=a.search(q);return a.charAt(d!==-1?d:'*');}z.formatFunction=function(a){return a.replace(h,A);};function B(a){var b=/[^a-z]+/gi,c='abcdefghijklmnopqrstuvwxyz',d=c.length,e={},f='',g,h,i;a=a.map(function(a){var c=a.replace(b,'');if(a!==c)throw new SyntaxError('"'+a+'" is an invalid variable name.');return c;});for(g=0;g<a.length;g++){if(e[a[g]])throw new ReferenceError('May not have duplicate parameter names.');h=g;while(h>=0){i=h%d;h=h-i;f=c.charAt(i)+f;h=h/d-1;}e[a[g]]=f;f='';}return e;}function C(a,b){var c=1;while(c>0&&b<a.length){if(a[b]==='(')c++;if(a[b]===')')c--;b++;}if(c>0)throw new SyntaxError('Expected ")".');return b-1;}function D(a,c){var d=0,e,f;for(e=c;e<a.length;e++){if(a[e]==='(')d++;else if(a[e]===')')d--;if(d<0)throw new SyntaxError('Unexpected token ")".');if(d===0)if(a[e]==='+'||(a[e]==='-'&&!s[a[e-1]])){f=a.substr(b.max(0,e-3)).search(p);if(f===-1||f>1)return e;}}return a.length;}function E(a,c){var d=0,e,f;for(e=c;e<a.length;e++){if(a[e]==='(')d++;else if(a[e]===')')d--;if(d<0)throw new SyntaxError('Unexpected token ")".');if(d===0){if(a[e]==='+'||(a[e]==='-'&&!s[a[e-1]])){f=a.substr(b.max(0,e-3)).search(p);if(f===-1||f>1)return e;}if(a[e]==='*'||a[e]==='/'||a[e]===' '||a[e]==='%')return e;}}return a.length;}function F(a,b,c){switch(a){case '+':case '-':return D(b,c);case '*':case ' ':case '/':case '%':case '^':return E(b,c);default:throw new SyntaxError('"'+a+'" is not a valid operator.');}}function G(){Array.apply(this,arguments);}G.prototype=[];G.prototype.push=function(){return Array.prototype.push.apply(this,arguments)-1;};G.prototype.Complex=z;function H(a,b,c){var d='',e=0,f=false,g,h,m,n,o,p;if(a.length===0)throw new SyntaxError('"" is not a valid argument.');while(e<a.length)if(!f&&a.substr(e).search(i)===0){g=a.substr(e).match(i)[0];m=r[g];switch(g){case '-':p=D(a,e+g.length);break;case 'e^':p=E(a,e+g.length);break;default:p=C(a,e+g.length);break;}if(!m){g=g.substr(0,g.length-1);if(!(t[g]||b[g]))throw new ReferenceError('"'+g+'(" is not a valid function.');a=a.substr(0,e)+g+'*('+a.substr(e+g.length+1);}else{d+=(m==='('?'':m);e+=g.length;try{var q=new G();var u=H(a.substring(e,p),[],q);var v=new Function('','var C=this.Complex;return '+u+';').bind(q)();d+='this['+c.push(v)+']';}catch(w){d+=H(a.substring(e,p),b,c);}finally{d+=(m==='('?'':')');}e=(a[p]===')'?p+1:p);f=true;}}else if(!f&&a.substr(e).search(j)===0){g=a.substr(e).match(j)[0];h=t[g]||b[g];if(!h)throw new ReferenceError('"'+g+'" is not a valid variable.');d+=h;e+=g.length;f=true;}else if(!f&&a.substr(e).search(l)===0){g=a.substr(e).match(l)[0];o=parseFloat(g);if(isNaN(o))throw new TypeError('"'+g+'" is not a valid number.');d+='this['+c.push(new z(o,0))+']';e+=g.length;f=true;}else if(f&&a.substr(e).search(k)===0){g=a.substr(e).match(k)[0];n=s[g];p=F(g,a,e+g.length);if(!n)throw new SyntaxError('"'+g+'" is not a valid operator.');d+=n;e+=g.length;try{var q=new G();var u=H(a.substring(e,p),[],q);var v=new Function('','var C=this.Complex;return '+u+';').bind(q)();d+='this['+c.push(v)+']';}catch(w){d+=H(a.substring(e,p),b,c);}finally{d+=')';}e=(a[p]===')'?p+1:p);f=true;}else throw new SyntaxError('Unexpected token "'+a.charAt(e)+'".');return d;}z.parseFunction=function(a,b,c){if(typeof b==='boolean'){c=true;b=[];}else if(!Array.isArray(b))b=[];if(!c)a=z.formatFunction(a);var d=B(b),e=new G(),f=H('('+a+')',d,e),g=b.map(function(a){return d[a];}).join(',');return new Function(g,'var C=this.Complex;return '+f+';').bind(e);};if(typeof module!=='undefined'&&module!==null&&module.exports)module.exports=z;else if(typeof define==='function'&&define.amd)define([],function(){return z;});else a.Complex=z;}(typeof global==='undefined'?this:global));